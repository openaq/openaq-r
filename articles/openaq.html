<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to openaq • openaq</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to openaq">
<meta name="description" content='"Get started with the openaq package"
'>
<meta property="og:description" content='"Get started with the openaq package"
'>
<meta property="og:image" content="https://openaq.github.io/openaq-r/logo.png">
<script defer data-domain="openaq.github.io/openaq-r" src="https://plausible.io/js/script.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openaq</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/openaq.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/geospatial-queries.html">geospatial-queries</a></li>
    <li><a class="dropdown-item" href="../articles/plotting.html">plotting</a></li>
    <li><a class="dropdown-item" href="../articles/querying-measurements.html">querying-measurements</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://join.slack.com/t/openaq/shared_invite/zt-yzqlgsva-v6McumTjy2BZnegIK9XCVw" aria-label="Slack"><span class="fa fa-slack"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openaq/openaq-r/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to openaq</h1>
            <h3 data-toc-skip class="subtitle">Get started with the
openaq package</h3>
                        <h4 data-toc-skip class="author">Russ Biggs</h4>
            
            <h4 data-toc-skip class="date">2025-01-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/openaq/openaq-r/blob/main/vignettes/openaq.Rmd" class="external-link"><code>vignettes/openaq.Rmd</code></a></small>
      <div class="d-none name"><code>openaq.Rmd</code></div>
    </div>

    
    
<p>This guide provides an overview of the key features of the openaq
package. For detailed information on the functions provided in the
package see the reference section.</p>
<p>For more general documentation on the OpenAQ platform and API see the
main OpenAQ documentation site at <a href="https://docs.openaq.org" class="external-link">docs.openaq.org</a>.</p>
<div class="section level2">
<h2 id="key-concepts">Key concepts<a class="anchor" aria-label="anchor" href="#key-concepts"></a>
</h2>
<div class="section level3">
<h3 id="api-key">API Key<a class="anchor" aria-label="anchor" href="#api-key"></a>
</h3>
<p>An API key is required for using the OpenAQ API. Register for an
account at <a href="https://explore.openaq.org/register" class="external-link">https://explore.openaq.org/register</a>
to get an API key.</p>
<aside style="padding: 16px; margin:16px; background-color: #fbdcda; border-inline-start-color: #dd443c; border-inline-start-style: solid; border-inline-start-width: 4px;"><span style="color:#8a0f3a; margin:0; padding: 6px;">Important</span>
Treat your API key as you would a password. Do not share your API key
with others. Do not commit your API key to version control to avoid
compromising the API key. If your API key is compromised, you can
request a new one in your OpenAQ Explorer account.
</aside><p>By default the OpenAQ R client looks for an API key in the
<code>OPENAQ_API_KEY</code> system environment variable. The package
also provides a helper function called <code><a href="../reference/set_api_key.html">set_api_key()</a></code> to set
this value.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_api_key.html">set_api_key</a></span><span class="op">(</span><span class="st">"my-super-secret-openaq-key-1234"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, the API key can be set on individual resource function
calls e.g.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_locations.html">list_locations</a></span><span class="op">(</span>api_key <span class="op">=</span> <span class="st">"my-super-secret-openaq-key-1234"</span><span class="op">)</span></span></code></pre></div>
<p>Setting the API key at an individual function level will always take
precedent over an API key set at the environment variable level
e.g. </p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_api_key.html">set_api_key</a></span><span class="op">(</span><span class="st">"my-super-secret-openaq-key-1234"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/list_locations.html">list_locations</a></span><span class="op">(</span>api_key <span class="op">=</span> <span class="st">"this-is-my-alternate-api-key"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="rate-limits">Rate limits<a class="anchor" aria-label="anchor" href="#rate-limits"></a>
</h3>
<p>OpenAQ limits the number of API requests you can make in a set time
to ensure fair access for all users and prevent overuse.</p>
<p>The OpenAQ API provides custom rate limit headers to indicate the
number of requests used, the number remaining, the rate limit allowance,
and the number of seconds remaining in the current period until reset.
These headers are preserved by default in the openaq package as object
attributes on the output data frame:</p>
<ul>
<li><code>x_ratelimit_used</code></li>
<li><code>x_ratelimit_remaining</code></li>
<li><code>x_ratelimit_limit</code></li>
<li><code>x_ratelimit_reset</code></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/list_locations.html">list_locations</a></span><span class="op">(</span></span>
<span>  limit <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  parameters_id <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  providers_id <span class="op">=</span> <span class="fl">166</span></span>
<span><span class="op">)</span></span>
<span><span class="va">headers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">locations</span>, <span class="st">"headers"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">headers</span><span class="op">[[</span><span class="st">"x_ratelimit_remaining"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># &gt; 59</span></span></code></pre></div>
<p>Read more about the headers and rate limits in the OpenAQ API
documentation under <a href="https://docs.openaq.org/using-the-api/rate-limits" class="external-link">Rate
Limits</a></p>
<p>The openaq package provides optional functionality to automatically
throttle requests when the rate limit has been reached.</p>
</div>
<div class="section level3">
<h3 id="pagination">Pagination<a class="anchor" aria-label="anchor" href="#pagination"></a>
</h3>
<p>The OpenAQ API uses pagination provide access to large amounts of
data in “pages”. The number of results is controlled by the
<code>limit</code> parameter which defaults 100 and can be configured up
to 1000 results. If your query results in more than the page limit you
can page through the results using the <code>page</code> parameter. For
a <code>limit = 1000</code> <code>page=1</code> will contain results
1-1000, <code>page=2</code> will contain results 1001-2000 an so on. The
<code>page</code> and <code>limit</code> are available on any resource
that returns more than on results, i.e. “list” functions such as
<code><a href="../reference/list_locations.html">list_locations()</a></code>, <code><a href="../reference/list_licenses.html">list_licenses()</a></code> or
<code><a href="../reference/list_sensor_measurements.html">list_sensor_measurements()</a></code></p>
<p>Examples:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_locations.html">list_locations</a></span><span class="op">(</span></span>
<span>  limit <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  page <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_locations.html">list_locations</a></span><span class="op">(</span></span>
<span>  limit <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  page <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h2>
<div class="section level3">
<h3 id="data-frames">Data frames<a class="anchor" aria-label="anchor" href="#data-frames"></a>
</h3>
<p>All resource functions return a typed data frame by default. If you
prefer to work with JSON parsed as a standard list you can toggle off
data frame parsing with the <code>as_data_frame</code> function
parameter.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_locations.html">list_locations</a></span><span class="op">(</span></span>
<span>  limit <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  parameters_id <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  providers_id <span class="op">=</span> <span class="fl">166</span>,</span>
<span>  as_data_frame <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#&gt; list()</span></span>
<span><span class="co">#&gt; attr(,"meta")</span></span>
<span><span class="co">#&gt; attr(,"meta")$name</span></span>
<span><span class="co">#&gt; [1] "openaq-api"</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; attr(,"meta")$website</span></span>
<span><span class="co">#&gt; [1] "/"</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; attr(,"meta")$page</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; ...</span></span></code></pre></div>
<p><code>as.data.frame</code> methods are provided for all resource
classes as well.</p>
<p>JSON results are parsed with the <code><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">httr2::resp_body_json()</a></code>
function under-the-hood.</p>
</div>
<div class="section level3">
<h3 id="automatic-rate-limiting">Automatic rate limiting<a class="anchor" aria-label="anchor" href="#automatic-rate-limiting"></a>
</h3>
<p>All resource function provide an option to enable automatic rate
limiting to ensure you do not exceed account rate limits. You can or
course implement your own rate limiting yourself, but the built-in
functionality is provided as an easy to use option.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_locations.html">list_locations</a></span><span class="op">(</span></span>
<span>  limit <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  parameters_id <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  providers_id <span class="op">=</span> <span class="fl">166</span>,</span>
<span>  rate_limit <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This functionality uses the OpenAQ API’s custom <a href="https://docs.openaq.org/using-the-api/rate-limits#rate-limit-headers" class="external-link">rate
limit headers</a> and the <code><a href="https://httr2.r-lib.org/reference/req_retry.html" class="external-link">httr2::req_retry()</a></code> function
under-the-hood.</p>
</div>
<div class="section level3">
<h3 id="debugging">Debugging<a class="anchor" aria-label="anchor" href="#debugging"></a>
</h3>
<p>Every resource function provides an optional parameter named
<code>DRY_RUN</code> that prevents a full HTTP request to the API and
instead prints out a summary of how the requestion would have been
made.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_locations.html">list_locations</a></span><span class="op">(</span></span>
<span>  limit <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  parameters_id <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  providers_id <span class="op">=</span> <span class="fl">166</span>,</span>
<span>  dry_run <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#&gt; GET /v3/locations?providers_id=166&amp;parameters_id=10&amp;limit=1000&amp;page=1 HTTP/1.1</span></span>
<span><span class="co">#&gt; Host: api.openaq.org</span></span>
<span><span class="co">#&gt; Accept-Encoding: gzip</span></span>
<span><span class="co">#&gt; X-API-Key: &lt;REDACTED&gt;</span></span>
<span><span class="co">#&gt; User-Agent: openaq-r</span></span>
<span><span class="co">#&gt; Content-Type: application/json</span></span>
<span><span class="co">#&gt; Accept: application/json</span></span></code></pre></div>
<p>This can be helpful when debugging to identify issues and compare the
raw query URL and headers.</p>
<p>This functionality uses the <code><a href="https://httr2.r-lib.org/reference/req_dry_run.html" class="external-link">httr2::req_dry_run()</a></code>
function under-the-hood.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Russ Biggs, Christian Parker, OpenAQ.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
