<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Integrating with ggplot2 • openaq</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Integrating with ggplot2">
<script defer data-domain="openaq.github.io/openaq-r" src="https://plausible.io/js/script.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openaq</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/openaq.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/geospatial-queries.html">Geospatial Queries</a></li>
    <li><a class="dropdown-item" href="../articles/ggplot2.html">Integrating with ggplot2</a></li>
    <li><a class="dropdown-item" href="../articles/plotting.html">Plotting</a></li>
    <li><a class="dropdown-item" href="../articles/querying-measurements.html">Querying measurements</a></li>
    <li><a class="dropdown-item" href="../articles/querying-rollups.html">Querying rolled up measurements</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://join.slack.com/t/openaq/shared_invite/zt-yzqlgsva-v6McumTjy2BZnegIK9XCVw" aria-label="Slack"><span class="fa fa-slack"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openaq/openaq-r/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Integrating with ggplot2</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openaq/openaq-r/blob/main/vignettes/ggplot2.Rmd" class="external-link"><code>vignettes/ggplot2.Rmd</code></a></small>
      <div class="d-none name"><code>ggplot2.Rmd</code></div>
    </div>

    
    
<p>The openaq package provides functionality for visualizing data
through the built-in R <code><a href="https://rdrr.io/r/base/plot.html" class="external-link">base::plot</a></code> package (see
vignette(“plotting”)). A popular alternative package for creating data
visualizations is <a href="https://ggplot2.tidyverse.org/" class="external-link"><code>ggplot2</code></a>, known
for its declarative API and ease of use for creating highly customized
plots. The <code>openaq</code> package automatically provides data
output as a data frame, making it straightforward to integrate openaq
with <code>ggplot2</code>.</p>
<p>To demonstrate how to use <code>ggplot2</code> with
<code>openaq</code>, we will query PM<sub>2.5</sub> measurement
data.</p>
<p>We will query data from sensor 12235029, a PM<sub>2.5</sub> sensor
located in Delhi, India, for May 2025. We make sure specify the correct
timezone (Asia/Kolkata) to ensure we query datetime in the local time of
the location.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pm25_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/list_sensor_measurements.html">list_sensor_measurements</a></span><span class="op">(</span></span>
<span>  <span class="fl">12235029</span>,</span>
<span>  datetime_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2025-05-01"</span>, tz <span class="op">=</span> <span class="st">"Asia/Kolkata"</span><span class="op">)</span>,</span>
<span>  datetime_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2025-05-31"</span>, tz <span class="op">=</span> <span class="st">"Asia/Kolkata"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pm25_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   value parameter_id parameter_name parameter_units period_label</span></span>
<span><span class="co">## 1    78            2           pm25           µg/m³          raw</span></span>
<span><span class="co">## 2    78            2           pm25           µg/m³          raw</span></span>
<span><span class="co">## 3    78            2           pm25           µg/m³          raw</span></span>
<span><span class="co">## 4    78            2           pm25           µg/m³          raw</span></span>
<span><span class="co">## 5    80            2           pm25           µg/m³          raw</span></span>
<span><span class="co">## 6    91            2           pm25           µg/m³          raw</span></span>
<span><span class="co">##   period_interval       datetime_from         datetime_to latitude longitude</span></span>
<span><span class="co">## 1        00:15:00 2025-05-01 00:45:00 2025-05-01 01:00:00       NA        NA</span></span>
<span><span class="co">## 2        00:15:00 2025-05-01 01:00:00 2025-05-01 01:15:00       NA        NA</span></span>
<span><span class="co">## 3        00:15:00 2025-05-01 01:15:00 2025-05-01 01:30:00       NA        NA</span></span>
<span><span class="co">## 4        00:15:00 2025-05-01 01:30:00 2025-05-01 01:45:00       NA        NA</span></span>
<span><span class="co">## 5        00:15:00 2025-05-01 02:30:00 2025-05-01 02:45:00       NA        NA</span></span>
<span><span class="co">## 6        00:15:00 2025-05-01 02:45:00 2025-05-01 03:00:00       NA        NA</span></span>
<span><span class="co">##   min q02 q25 median q75 q98 max avg sd expected_count expected_interval</span></span>
<span><span class="co">## 1  NA  NA  NA     NA  NA  NA  NA  NA NA              1          00:15:00</span></span>
<span><span class="co">## 2  NA  NA  NA     NA  NA  NA  NA  NA NA              1          00:15:00</span></span>
<span><span class="co">## 3  NA  NA  NA     NA  NA  NA  NA  NA NA              1          00:15:00</span></span>
<span><span class="co">## 4  NA  NA  NA     NA  NA  NA  NA  NA NA              1          00:15:00</span></span>
<span><span class="co">## 5  NA  NA  NA     NA  NA  NA  NA  NA NA              1          00:15:00</span></span>
<span><span class="co">## 6  NA  NA  NA     NA  NA  NA  NA  NA NA              1          00:15:00</span></span>
<span><span class="co">##   observed_count observed_interval percent_complete percent_coverage</span></span>
<span><span class="co">## 1              1          00:15:00              100              100</span></span>
<span><span class="co">## 2              1          00:15:00              100              100</span></span>
<span><span class="co">## 3              1          00:15:00              100              100</span></span>
<span><span class="co">## 4              1          00:15:00              100              100</span></span>
<span><span class="co">## 5              1          00:15:00              100              100</span></span>
<span><span class="co">## 6              1          00:15:00              100              100</span></span></code></pre>
<p>In this exercise, we will demonstrate how to plot both a box plot and
a histogram with <code>ggplot2</code>. The plots are common
visualizations for exploring air quality measurement data and will serve
as guides for working with <code>ggplot</code> and <code>openaq</code>.
A box plot illustrates the distribution of PM<sub>2.5</sub> values in
May 2025. It shows the median, interquartile range, and helps identifies
outliers in the dataset. This chart can help us understand the overall
spread and average levels of particulate matter.</p>
<p><code>ggplot2</code> makes creating this kind of plot easy with it’s
<code>ggplot2::geom_boxplot()</code> function. Because the data from the
<code>openaq</code> is presented in long format and as a data frame we
can directly add the data to the <code>ggplot2::ggplot()</code> function
for charting.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">pm25_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Summary of May 2025 Data in Delhi, India"</span>,</span>
<span>    y <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"PM"</span><span class="op">[</span><span class="fl">2.5</span><span class="op">]</span><span class="op">~</span><span class="st">"Concentration ("</span><span class="op">*</span><span class="va">mu</span><span class="op">*</span><span class="st">"g/m"</span><span class="op">^</span><span class="fl">3</span><span class="op">*</span><span class="st">")"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_grey</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figure/ggplot2-box-plot-1.png" alt="plot of chunk ggplot2-box-plot"><div class="figcaption">plot of chunk ggplot2-box-plot</div>
</div>
<p>Now, let’s summarize the frequency distribution of PM<sub>2.5</sub>
values over the month. We will use a histogram, for which
<code>ggplot2</code> provides the <code>ggplot2::geom_histogram()</code>
function. To calculate an optimal bin width for the histogram we can use
<a href="https://en.wikipedia.org/wiki/Scott%27s_rule" class="external-link">Scott’s Rule</a>,
which adapts to the data spread and size.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scott_bw</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/nclass.html" class="external-link">nclass.scott</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This histogram provides a quick view of the overall distribution and
skew of the data, highlighting standard value ranges and the presence of
high-pollution events.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">pm25_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    binwidth <span class="op">=</span> <span class="fu">scott_bw</span><span class="op">(</span><span class="va">pm25_data</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_grey</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figure/ggplot2-histogram-1.png" alt="plot of chunk ggplot2-histogram"><div class="figcaption">plot of chunk ggplot2-histogram</div>
</div>
<p>You can customize your histogram by changing the color and fill as
shown below. This histogram highlights overall distribution and possible
high-pollution events. You can further customize fill color, bins, and
themes.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">pm25_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    binwidth <span class="op">=</span> <span class="fu">scott_bw</span><span class="op">(</span><span class="va">pm25_data</span><span class="op">$</span><span class="va">value</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#584DAE"</span>, color <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Customized Histogram of PM"</span><span class="op">[</span><span class="fl">2.5</span><span class="op">]</span><span class="op">~</span><span class="st">"Measurements"</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"PM"</span><span class="op">[</span><span class="fl">2.5</span><span class="op">]</span><span class="op">~</span><span class="st">"Concentration ("</span><span class="op">*</span><span class="va">mu</span><span class="op">*</span><span class="st">"g/m"</span><span class="op">^</span><span class="fl">3</span><span class="op">*</span><span class="st">")"</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Count"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figure/custom-ggplot2-histogram-1.png" alt="plot of chunk custom-ggplot2-histogram"><div class="figcaption">plot of chunk custom-ggplot2-histogram</div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Russ Biggs, Christian Parker, OpenAQ.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
