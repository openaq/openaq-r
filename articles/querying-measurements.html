<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>querying-measurements • openaq</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="querying-measurements">
<script defer data-domain="openaq.github.io/openaq-r" src="https://plausible.io/js/script.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openaq</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/openaq.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/geospatial-queries.html">geospatial-queries</a></li>
    <li><a class="dropdown-item" href="../articles/plotting.html">plotting</a></li>
    <li><a class="dropdown-item" href="../articles/querying-measurements.html">querying-measurements</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://join.slack.com/t/openaq/shared_invite/zt-yzqlgsva-v6McumTjy2BZnegIK9XCVw" aria-label="Slack"><span class="fa fa-slack"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openaq/openaq-r/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>querying-measurements</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openaq/openaq-r/blob/main/vignettes/querying-measurements.Rmd" class="external-link"><code>vignettes/querying-measurements.Rmd</code></a></small>
      <div class="d-none name"><code>querying-measurements.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/openaq/openaq-r" class="external-link">openaq</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates how to use the openaq R package to query
air quality measurements from the OpenAQ API. We will walk through the
process of retrieving a list of locations, inspecting their sensors and
parameters, and finally, fetching and plotting the actual measurements
for a specific sensor.</p>
<div class="section level3">
<h3 id="listing-locations">Listing Locations<a class="anchor" aria-label="anchor" href="#listing-locations"></a>
</h3>
<p>The <code><a href="../reference/list_locations.html">list_locations()</a></code> function allows us to retrieve
information about monitoring locations. We can filter locations based on
parameters and countries. Here, we are searching for locations that
measure PM<sub>2.5</sub> (parameter ID 2) in Madagascar (country ID
182). By default resource functions return a data frame but we set
<code>as_data_frame = FALSE</code> to receive the data as a list, which
we will use for easier inspection in the following steps.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/list_locations.html">list_locations</a></span><span class="op">(</span></span>
<span>  parameters_id <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  countries_id <span class="op">=</span> <span class="fl">182</span>,</span>
<span>  as_data_frame <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The locations object is a list, where each element represents a
monitoring location. Let’s examine the first location in the list and
explore its sensors.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">location</span> <span class="op">&lt;-</span> <span class="va">locations</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">sensors</span> <span class="op">&lt;-</span> <span class="va">location</span><span class="op">$</span><span class="va">sensors</span></span>
<span><span class="va">sensors</span></span>
<span><span class="co"># &gt; [[1]]</span></span>
<span><span class="co"># &gt; [[1]]$id</span></span>
<span><span class="co"># &gt; [1] 225221</span></span>
<span><span class="co"># &gt;</span></span>
<span><span class="co"># &gt; [[1]]$name</span></span>
<span><span class="co"># &gt; [1] "pm25 µg/m³"</span></span>
<span><span class="co"># &gt;</span></span>
<span><span class="co"># &gt; [[1]]$parameter</span></span>
<span><span class="co"># &gt; [[1]]$parameter$id</span></span>
<span><span class="co"># &gt; [1] 2</span></span>
<span><span class="co"># &gt;</span></span>
<span><span class="co"># &gt; [[1]]$parameter$name</span></span>
<span><span class="co"># &gt; [1] "pm25"</span></span>
<span><span class="co"># &gt;</span></span>
<span><span class="co"># &gt; [[1]]$parameter$units</span></span>
<span><span class="co"># &gt; [1] "µg/m³"</span></span>
<span><span class="co"># &gt;</span></span>
<span><span class="co"># &gt; [[1]]$parameter$displayName</span></span>
<span><span class="co"># &gt; [1] "PM2.5"</span></span></code></pre></div>
<p>Each location contains information about its sensors. Each sensor has
an id, name, and details about the measured parameter, including its
name, units, and ID.</p>
<p>Each location also provides the timezone of where it is local, which
will be helpful when querying measurements, so we will store this for
later.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tz</span> <span class="op">&lt;-</span> <span class="va">location</span><span class="op">$</span><span class="va">timezone</span></span>
<span><span class="va">tz</span></span>
<span><span class="co"># &gt; [1] "Indian/Antananarivo"</span></span></code></pre></div>
<p>To fetch measurements, we need the sensor ID. This location only
measures PM<sub>2.5</sub> and in turn only has one sensor so we can
extract it as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sensors_id</span> <span class="op">&lt;-</span> <span class="va">sensors</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">id</span></span>
<span><span class="va">sensors_id</span></span>
<span><span class="co"># &gt; [1] 225221</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="fetching-measurements">Fetching Measurements<a class="anchor" aria-label="anchor" href="#fetching-measurements"></a>
</h2>
<p>Now we can use the <code><a href="../reference/list_sensor_measurements.html">list_sensor_measurements()</a></code> function
to retrieve the measurements for the sensor. We need to provide the
<code>sensors_id</code>, <code>datetime_from</code>, and
<code>datetime_to</code> arguments. We will query for all measurements
during the month of January 2025.It is important to use the correct
timezone for your dates, we use the timezone for location that we stored
in the <code>tz</code> variable above. The limit argument controls the
maximum number of measurements returned in a single page of results.
Because this is hourly data, and we are querying 31 days of
measurements, we will be able to view all the results in one page (24
hourly measurements * 31 days = 744 measurements).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">measurements</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/list_sensor_measurements.html">list_sensor_measurements</a></span><span class="op">(</span></span>
<span>  <span class="va">sensors_id</span>,</span>
<span>  datetime_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2025-01-01"</span>, tz <span class="op">=</span> <span class="va">tz</span><span class="op">)</span>,</span>
<span>  datetime_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2025-01-31"</span>, tz <span class="op">=</span> <span class="va">tz</span><span class="op">)</span>,</span>
<span>  limit <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can visualize the measurements using the
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">measurements</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Russ Biggs, Christian Parker, OpenAQ.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
