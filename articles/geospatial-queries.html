<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>geospatial-queries • openaq</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="geospatial-queries">
<script defer data-domain="openaq.github.io/openaq-r" src="https://plausible.io/js/script.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openaq</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/openaq.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/geospatial-queries.html">geospatial-queries</a></li>
    <li><a class="dropdown-item" href="../articles/plotting.html">plotting</a></li>
    <li><a class="dropdown-item" href="../articles/querying-measurements.html">querying-measurements</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://join.slack.com/t/openaq/shared_invite/zt-yzqlgsva-v6McumTjy2BZnegIK9XCVw" aria-label="Slack"><span class="fa fa-slack"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openaq/openaq-r/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>geospatial-queries</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openaq/openaq-r/blob/main/vignettes/geospatial-queries.Rmd" class="external-link"><code>vignettes/geospatial-queries.Rmd</code></a></small>
      <div class="d-none name"><code>geospatial-queries.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/openaq/openaq-r" class="external-link">openaq</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">maps</span><span class="op">)</span></span></code></pre></div>
<p>The OpenAQ API has the ability to perform geospatial queries,
enabling you to retrieve data based on location. This vignette will
guide you through the two primary geospatial query methods available in
<code>openaq</code>: point and radius searches, and bounding box
searches.</p>
<p><code>openaq</code> provides access to two methods for querying
locations on the OpenAQ platform geospatially:</p>
<ol style="list-style-type: decimal">
<li><p>Point and Radius: Searches around a given point coordinate
(latitude, longitude) at a specified radius in meters. This is ideal for
finding air quality data within a certain distance of a specific
location.</p></li>
<li><p>Bounding Box: Searches within a spatial bounding box defined as a
list of four coordinates: <code>xmin</code>, <code>ymin</code>,
<code>xmax</code>, and <code>ymax</code>. This method is useful for
querying data within a rectangular area.</p></li>
</ol>
<div class="section level2">
<h2 id="point-and-radius">Point and Radius<a class="anchor" aria-label="anchor" href="#point-and-radius"></a>
</h2>
<p>The <code>list_location()</code> function allows you to search for
locations near a given point. You provide the latitude and longitude of
the center point, as well as the radius within which to search. The
radius is specified in meters, with a maximum value of 25,000 (25
kilometers).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">list_location</span><span class="op">(</span></span>
<span>  coordinates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>latitude <span class="op">=</span> <span class="op">-</span><span class="fl">73.0666</span>, longitude <span class="op">=</span> <span class="op">-</span><span class="fl">36.7724</span><span class="op">)</span>, <span class="co"># the coordinates in Concepción, Chile.</span></span>
<span>  radius <span class="op">=</span> <span class="fl">10000</span> <span class="co"># 10,000 meters or 10 kilometers</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In this example, we are searching for locations within a 10 kilometer
radius of the specified latitude and longitude. The result will be a
list of locations that fall within this circular area.</p>
</div>
<div class="section level2">
<h2 id="bounding-box">Bounding box<a class="anchor" aria-label="anchor" href="#bounding-box"></a>
</h2>
<p>For queries covering a rectangular area, you can use the
<code><a href="../reference/list_locations.html">list_locations()</a></code> function with the bbox argument. You need
to provide the minimum and maximum longitude (<code>xmin</code>,
<code>xmax</code>) and latitude (<code>ymin</code>, <code>ymax</code>)
values that define the corners of your bounding box.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_locations.html">list_locations</a></span><span class="op">(</span></span>
<span>  bbox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    xmin <span class="op">=</span> <span class="op">-</span><span class="fl">8.478184</span>,</span>
<span>    ymin <span class="op">=</span> <span class="fl">26.640174</span>,</span>
<span>    xmax <span class="op">=</span> <span class="fl">50.803066</span>,</span>
<span>    ymax <span class="op">=</span> <span class="fl">46.534067</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This query will return all locations within the defined rectangular
region.</p>
<p><img src="geospatial-queries_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>The map above visually represents the bounding box used in the
example query.</p>
<div class="section level3">
<h3 id="computing-a-bounding-box-from-a-polygon">Computing a bounding box from a polygon<a class="anchor" aria-label="anchor" href="#computing-a-bounding-box-from-a-polygon"></a>
</h3>
<p>Often, you’ll want to query data within a specific geographic area
defined by a polygon, rather than a simple rectangle. Real-world
boundaries are often complex shapes. For instance, consider the boundary
of the city of Los Angeles, which has a complex, irregular shape.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://maps.lacity.org/lahub/rest/services/Boundaries/MapServer/7/query?outFields=*&amp;where=1%3D1&amp;f=geojson"</span></span>
<span><span class="va">la</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `OGRGeoJSON' from data source </span></span>
<span><span class="co">#&gt;   `https://maps.lacity.org/lahub/rest/services/Boundaries/MapServer/7/query?outFields=*&amp;where=1%3D1&amp;f=geojson' </span></span>
<span><span class="co">#&gt;   using driver `GeoJSON'</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -118.6682 ymin: 33.70366 xmax: -118.1554 ymax: 34.33731</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">la</span><span class="op">[</span><span class="st">"OBJECTID"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="geospatial-queries_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>We can use the <code>sf</code> package to read the GeoJSON data
representing the city boundary.</p>
<p>To derive a bounding box from this polygon, we can use the
<code><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">sf::st_bbox()</a></code> method. This function calculates the minimum
and maximum x and y coordinates of the polygon, effectively creating a
bounding box that encompasses the entire shape. The output is a named
numeric vector, perfectly formatted for the bbox parameter in the
<code>openaq</code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">la</span><span class="op">)</span></span>
<span><span class="va">bbox</span></span>
<span><span class="co">#&gt;       xmin       ymin       xmax       ymax </span></span>
<span><span class="co">#&gt; -118.66819   33.70366 -118.15537   34.33731</span></span></code></pre></div>
<p>This output gives you the xmin, ymin, xmax, and ymax values needed
for your <code>openaq</code> query.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">la</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">la</span><span class="op">[</span><span class="st">"OBJECTID"</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="geospatial-queries_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>This map shows the Los Angeles city boundary along with the
calculated bounding box.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_locations.html">list_locations</a></span><span class="op">(</span></span>
<span>  bbox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="fl">100.052893</span>, ymin <span class="op">=</span> <span class="fl">13.495250</span>, xmax <span class="op">=</span> <span class="fl">101.041662</span>, ymax <span class="op">=</span> <span class="fl">13.974828</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now, you can directly use the <code>bbox</code> object generated by
<code><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">sf::st_bbox()</a></code> in your <code><a href="../reference/list_locations.html">list_locations()</a></code> call.
This will retrieve air quality data within the bounding box that
encompasses the city of Los Angeles.</p>
<p>For a detailed explanation about how the OpenAQ API works with these
methods, see the official OpenAQ API documentation at <a href="https://docs.openaq.org/using-the-api/geospatial" class="external-link uri">https://docs.openaq.org/using-the-api/geospatial</a>. This
documentation provides further information on the available parameters
and how to optimize your geospatial queries.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Russ Biggs, Christian Parker, OpenAQ.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
